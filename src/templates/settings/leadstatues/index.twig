{% set tableData = [] %}
{% if leadStatuses|length %}
    {% for leadStatus in leadStatuses %}

        {% set cpEditUrl = cpUrl('estimator-wizard/settings/lead-statuses/' ~ leadStatus.id) %}
        {% set showDelete = leadStatus.isDefault or leadStatus.handle == 'spam' ? false : true %}

        {% set tableData = tableData|merge([{
            id: leadStatus.id,
            labelHtml: {
                url: cpEditUrl,
                color: leadStatus.color,
                name: leadStatus.name
            },
            title: leadStatus.name|t('estimator-wizard')|e,
            url: cpEditUrl,
            handle: leadStatus.handle,
            isDefault: leadStatus.isDefault,
            _showDelete: showDelete
        }]) %}

    {% endfor %}
{% endif %}

<h2>{{ "Lead Statuses"|t('estimator-wizard') }}</h2>
<p>{{ "Define the statuses that can be set on form leads once they’ve been completed."|t('estimator-wizard') }}</p>

<div id="lead-statuses-admin-table"></div>

{% do view.registerAssetBundle('craft\\web\\assets\\admintable\\AdminTableAsset') -%}

{# @todo - Not yet supported: deleteFailMessage
    "Unable to delete status. Please remove this status from all Form Leads first."
     Also no way to disable a particular row from being deleted. Ideally we could just hide the delete button. #}
{% js %}
    var columns = [
    {
    name: 'labelHtml',
    title: Craft.t('estimator-wizard', 'Name'),
    callback: function(value) {
    return '<a class="cell-bold estimatorWizardStatusLabel" href="' + value.url + '"><span class="status ' + value.color + '"></span>' + value.name + '</a>';
    }
    },
    {
    name: '__slot:handle',
    title: Craft.t('estimator-wizard', 'Handle')
    },
    {
    name: 'isDefault',
    title: Craft.t('estimator-wizard', 'Default Status'), callback: function(value) {
    if (value) {
    return '<span data-icon="check" title="' + Craft.t('estimator-wizard', 'Yes') + '"></span>';
    }
    return '';
    }
    }
    ];

    new Craft.VueAdminTable({
    columns: columns,
    container: '#lead-statuses-admin-table',
    deleteAction: 'estimator-wizard/lead-statuses/delete',
    deleteConfirmationMessage: Craft.t('estimator-wizard', "Are you sure you want to delete the Lead Status “{name}”?"),
    deleteSuccessMessage: Craft.t('estimator-wizard', "Lead status deleted"),
    deleteFailMessage: Craft.t('estimator-wizard', "Unable to delete status. Status must not be used on existing entries."),
    emptyMessage: Craft.t('estimator-wizard', 'No lead statuses exist yet.'),
    minItems: 2,
    padded: true,
    reorderAction: 'estimator-wizard/lead-statuses/reorder',
    reorderSuccessMessage: Craft.t('estimator-wizard', 'Lead statuses reordered.'),
    reorderFailMessage: Craft.t('estimator-wizard', 'Couldn’t reorder statuses.'),
    tableData: {{ tableData|json_encode|raw }}
    });
{% endjs %}
